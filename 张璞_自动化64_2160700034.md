#数字图像处理第三次作业



> **姓名**：张璞



> **班级**：自动化64



> **学号**：2160700034



> **提交日期**：2019年3月19日

**摘要**

灰度直方图是数字图像处理中最简单且有用的工具，它是多种空域处理技术的基础。本文通过使用MATLAB的编程，分别实现了灰度直方图的绘制、直方图均衡、直方图匹配、局部直方图增强及基于直方图的图像阈值分割操作，利用了imhist（）、histeq（）、graythresh（）函数等，都得出了较好的结果，并在此基础上对不同对比度图片的处理结果进行比较，分析各操作的优缺点。

**关键词：** 直方图 均衡化 直方图匹配 局部直方图增强 直方图分割

图像直方图的绘制
----------------

1.**直方图简介**

直方图，是一种二维统计图表，它的两个坐标分别是统计样本和该样本对应的某个属性的度量。在图像处理的应用中，直方图横坐标代表了图像的像素种类，纵坐标代表了每一种像素值在图像中所有像素个数中的占比，其计算公式如下所示，

p(r_k )=n_k/n

式中，r_k表示第k个灰度级；n_k表示第k个灰度级的像素总数；n表示图像像素的总数。

对于每幅图像都可做出其灰度直方图。根据直方图的形态可以大致推断图像质量的好坏。图像的灰度值是离散变量，因此直方图表示的是离散的概率分布。任何一幅特定的图像都有唯一的直方图与之对应，但不同的图像可以有相同的直方图。如果一幅图像有两个不相连的区域组成，并且每个区域的直方图已知，则整幅图像的直方图是该两个区域的直方图之和。



2.**实现过程**

根据前述知识，首先利用MATLAB中的imread（）函数打开指定路径的图像，然后利用rgb2gray（）函数将题中所给RGB图像转化为灰度图像，最后利用imhist（）可直接绘制图像的直方图。





3.**实验结果**

![](media/bb4ce1539e0ad3a72ac8f10fe59f5a91.png)

![](media/2602b2c431c9153572646ff8489c2a35.png)

![](media/8ef47dd9f22382496bbd5b9b54d45133.png)

![](media/7456b67e329f5652792b11d1d6ead5ec.png)

![](media/288a0f78113fd0edaff773233f039217.png)

![](media/be0dc85f96574f4750033f8199f1ae50.png)

![](media/b1c21bb5d9fe46724dcc623cfde38e7b.png)

4.**结果分析**

分析上述图片与其直方图可以看出，一些图像的直方图分布较为均匀，一些图像的直方图分布集中在像素值偏高或偏低的区域中。从视觉上效果上分析，暗图像直方图分布集中在灰度级的低端，亮图像直方图分布集中在灰度级的高端，低对比度（即模糊的图像）图像的直方图分布范围较窄，高对比度（清晰的图像）图像的直方图分布范围较宽。

由此也可看出灰度直方图并不能较为全面的反映图像像素的全部信息，丢失了图像中像素分布的位置信息。

直方图均衡
----------

1.**直方图均衡简介**

直方图均衡化是将原图像的直方图通过变换函数变为均匀的直方图，然后按均匀直方图修改原图像，从而获得一幅灰度分布均匀的新图像。其重点是找到变换函数实现输出图像的灰度值能够在整个范围内均匀分布。

用变r表示输入图像的灰度，用s表示输出图像的灰度。r范围是[0,L-1]，则函数S=T(r)为输入图像与输出图像的灰度值变换函数，T(r)满足以下条件，

1.  T(r) 在区间[0 , L-1]
    严格单调递增函数。 这个条件保证了输入图像灰度值高的地方，输出图像的灰度值也高，不会对原图像的性质反生改变。

2.  当 r 的范围为[0 , L-1] 时，T(r)也在[0 , L-1]内。

对于离散的直方图，其变换函数可选如下的形式，

>   S_k=T(r_k )=(L-1) ∑_(j=0)^k▒〖p_r (r_j ) 〗=(L-1)/MN ∑_(j=0)^k▒n_j ,    k=0,1,2…,L-1

式中，p_r （）表示随机变量r的概率密度函数；MN表示图像的总像素数；L表示图像的灰度级数。由于求和函数总为正，因此其为单调递增函数，满足条件1）。当在该等式中上限是r=L-1时，其求和函数等于1，所以s的值最大为L-1，因此2）的条件也是满足的。

2.**实验过程**

根据相关资料可知，MATLAB中实现直方图均衡化处理的函数为，J=histeq(I，n)，其中I为输入的原图像，J为直方图均衡化后得到的图像，n为均衡化后的灰度级数，默认为64。

3.**实验结果**

![](media/d7cfe91c7c978a024b1b4e936fda8de5.png)

![](media/cd5f7a80c53bd55f9a5fd66155ba21b1.png)

![](media/cb108c6c1342d40ac69592de00fb7e41.png)

![](media/0c0fcffd8a251e7a888547bd386afeb0.png)

(a)四幅原始图像的均衡化效果

![](media/4ba3cfdfdba5cc64f1c2d236c3998087.png)

![](media/1d41da17a8bbafc6184cc586043b0e7c.png)

![](media/93ac415d6dd09c568e9f8f4cbf2b1dcf.png)

![](media/24347e49ddca5479e38c248d912d5041.png)

![](media/530a3a98263211fff921de5e0c2673c9.png)

![](media/51e79349069264852c1b3a0c0ce3fe3a.png)

(b)几幅对比度较低的图像的均衡化效果

![](media/2f892e5c2180fbe05a5ef6df3fb07dfd.png)

![](media/f326902ced5d0e6d9c00c656b2221585.png)

![](media/290bc054f537712cf4e04ad14115a415.png)

![](media/d1fb853bb5a71c0788a65c839dd1de44.png)

(c)灰度级较小的图片的均衡效果

4.**结果分析**

如上述所示，直方图均衡变换函数具有展开输入图像直方图的趋势，均衡后的图像的灰度级跨越更宽的灰度级范围，最终结果为增强了对比度。

从（a）组图像的处理结构来看，直方图均衡对原图像并未产生太大的效果，因为原图像的灰度均已扩张到了全部的灰度级范围，仅在图像中一些灰度值较高或较低的区域造成了较为明显的均衡效果，但从视觉效果上来看，也同时造成了图像的过度曝光。

从（b）组图像的处理结构来看，直方图均衡对对比度较小的图像（即灰度值集中在某些特定的值上）的均衡效果较好，因为直方图均衡使其灰度范围扩展到了整个灰度级范围，图像的一些细节得以体现，更接近原图像。

从（c）组图像的处理结构来看，直方图均衡对接近二值分布的图像的均衡效果并不理想，前两幅图虽稍有改善，但是由于它们并不是严格的二值分布图像，因此运用直方图均衡对二值图像进行视觉上的改善是不可行的。

直方图匹配
----------

1.**直方图匹配简介**

如上一问所述，直方图均衡能自动确定变换函数，但根据前述的结果分析，对于某些图像采用均匀直方图的基本增强并不是最好的方法。因此引入直方图匹配，可将原图的直方图变换为规定形式的直方图形式。

直方图规定化的步骤如下所示，

1.  计算给定图像的直方图p_r （r），并用它寻找式（2）的直方图均衡变换，并将$$s_{k}$$四舍五入为范围[0，L-1]内的整数。

2.  用式（3）对q=0,1,2,…,
    L-1计算变换函数G的所有值，其中p_z （z_i）是规定的直方图的值。将G的值四舍五入为范围[0，L-1]内的整数。

3.  对每一个值s_k，使用步骤2）中得到的G值寻找相应的z_q值。

4.  **实验过程**

此处以高斯分布作为匹配图像的直方图分布形式，高斯分布如下所示，

![](media/f1c4183468f17735b02ae1e320e97aa8.png)

2.**实验结果**

对所有图像分别进行直方图匹配，可得匹配结果，发现经原图像变换后的图像与高斯分布匹配后其直方图分布与原图像相同，因此只图像选取原图像与其匹配后的直方图展示，如下图所示，

![](media/a8da6176ed90872e965aa7e74f654723.png)

![](media/64362d943380d77379b53e5560ea7d93.png)

![](media/b277c58b529cd9f64b627bb14f9ea1ae.png)

![](media/e34fd5301310796aa61c04ae5cb6c7e9.png)

![](media/cbedd621bab5f5847a3bb135a02a8045.png)

![](media/ff5720a869aab6c26f616a90aa67056a.png)

![](media/eb0a201ee7289320e016c6684d774154.png)

![](media/7e820f1a3b09d6ff28986e9855708879.png)

3.**结果分析**

与直方图均衡化相比，直方图匹配操作更加灵活。当使用均衡化达不到目的时，比如均衡化后图像依然整体低对比度或者某些细节因为低对比度而无法细致观察，指定恰当的目标直方并进行直方图匹配化一般可以取得较好的效果，原始直方图的细小改变会使图像的外观得到显著改进。

局部直方图增强
--------------

1.**局部直方图增强简介**

问题二与问题三所讨论的直方图处理方法是全局性的，像素被基于整幅图像的灰度分布的变换函数所修改。但在一些情况下，增强图像中小区域的细节也是需要的，这些区域中，一些像素的影响在全局变换的计算中可能被忽略了，因为全局变换没有必要保证期望的局部增强。解决方法是以图像中每个像素的邻域中的灰度分布为基础设计变换函数。

判断一个区域在点f（x，y）是暗还是亮的方法是把局部平均灰度与全局均值进行比较，当局部平均灰度小于全局均值时，则将点f（x，y）处的像素值考虑为候选处理点。局部直方图增强的方法可总结为：令f（x，y）表示在图像任意坐标（x，y）处的像素值，而令g（x，y）表示这些坐标处相应的增强的像素值，则对于x=0,1,2…,M-1,y=0,1,2,…,N-1,有，

g(x,y)=

{(E*f(x,y),       m_(s_xy )≤k_0 m_G 且k_1 σ_G≤ σ_(s_xy )≤k_2 σ_G

f(x,y)  ,                                                                     其他

其中，E，k_0，k_1和k_2是规定的参数；m_G是输入图像的全局均值；σ_G是输入图像的标准差。参数m_(s_xy )和σ_(s_xy )是局部均值与标准差。

2.**实验结果**

选取E=4，k_0=0.4，k_1=0.02，k_2=0.4，可得处理结果如下所示，

![](media/fe622360cf423b95c0f47e32ad4d0de7.png)

![](media/3cc6253f049f00b2e50dae9b8e3b74ca.png)

![](media/0ddbb65be68976cc67027b61b930d362.png)

![](media/53cb978b333f2aa65bf3905738f18c09.png)

![](media/1a568c5506905f29a096f4b7e1f03ab9.png)

![](media/a6116e0ed42f5f2bf6e21761edcf1fe3.png)

![](media/cde6f2dfdc097be329025fa2ee8cfb6f.png)

![](media/b68e1944c805d696bf658011def5ce19.png)

3.**结果分析**

从上图可以看到，上图中增强图像的放大图像是放大f(x,y)的值至范围之外形成g(x,y)而构成的一幅图像，相对于黑暗部分的是1，相对于明亮部分的是E，暗点表示在该坐标处增强过程没有放大像素值，亮点表示产生了一个增强的像素值。该图像是二值图像。

局部增强能够增强暗色区域，同时尽可能保留明亮区域不变。从图中可以看出，局部增强使图像细节变得清楚。

图像的直方图分割
----------------

1.**直方图分割简介**

图像分割是把图像分割为若干特定的、具有独特性质的区域并提出感兴趣的目标区域的技术和过程。现有的图像分割技术主要包括以下几类：基于阈值的分割方法、基于区域的分割方法、基于边缘的分割方法以及基于特定理论的分割方法等。

基于直方图的分割图像方法是非常有效的图像分割方法，即在灰度直方图上取谷点作为分割阈值来对图像进行二值化。这种方法要求灰度直方图的分布具有峰值与谷点，分别与图像的背景及人物对应，当分割阈值选取为谷点即可对图像进行较好的分割。因此，寻找图像灰度直方图中的谷点像素值是至关重要的一步。根据查阅资料，可选择基于“谷地容量”最大化的直方图阈值分割算法对图像进行分割。

1.直方图的采样平滑内插

通过对elian与woman图像的直方图观察可以看出，其直方图整体表现出一种与图像本身像素值分布相关联的轮廓，但其相邻的离散像素点之间存在起伏，这是由于图像中夹杂着高频噪声的原因，因此为在后续计算中更加精准地定位到直方图谷地，应对直方图进行平滑滤波。



2.谷地定位及容量计算

谷地为两个相邻的峰值及中间的谷点，每个谷地对应两个峰值及一个谷点，因此可选取谷地作为一个谷点的特征。其具体计算过程如下所示，

3.对直方图信号a(n)进行一阶差分，得到差分数组	d(n)
d(n)=a(n+1)-a(n)




4.遍历整个信号数组，对峰值与谷点进行标记，

>   峰值：d(n-1)>0且d(n)<0


> 谷点：d(n-1)<0且d(n)>0


 

5.根据谷点的位置查找相邻的两个峰值点，找出每个谷点的三个关键特征：起始峰值点p_h，谷点v，终止峰值p_e。

  

6.计算每个谷地的容量C，其计算公式如下所示，



> C=∑_(j=p_h)^(p_e)▒〖[a(p)-a(j)],    a(p)=max⁡{a(p_h ),a(p_e )}〗



7.选取容量最大的谷地所对应的谷点坐标作为二值分割的阈值。

2.**实验过程**

使用最大类间方差法找到图片的一个合适的阈值，在使用im2bw函数将灰度图像转换为二值图像时，需要设定一个阈值，graythresh（）函数可以使用最大类间方差法找到图片的一个合适的阈值，利用这个阈值可以更好地将灰度图像转换为二值图像。

3.**实验结果**

![](media/34779dd823640a10c7c004443f9cb60d.png)

![](media/e02247144b0b86da10fd0046d50743f2.png)

![](media/0e668f0c012e71994b9715c05e0a8497.png)

![](media/52d94465ee8a8d0c36dd1996015bc6bc.png)

4.**结果分析**

通过对原始图像与分割后的图像对比看，调用MATLAB中的函数达到了对图像进行分割的目的。

**参考文献**

[1]赵小川. MATLAB图像处理——程序实现与模块化仿真. 北京：北京航空航天大学出版社.
2014.

[2]Kenneth R.Castleman. 数字图像处理. 朱志刚，林学訚，石定机，等译.
北京：电子工业出版社. 2001.

[3]王文宁，王汇源，牟文英. 一种新的灰度直方图分割阈值的自动检测方法[J].
计算机工程与应用. 2005,(26):89-90+173.



